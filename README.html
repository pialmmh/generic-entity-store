<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenericEntityStorage Library Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Left Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: #f6f8fa;
            border-right: 1px solid #e1e4e8;
            padding: 20px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        
        .sidebar h3 {
            font-size: 14px;
            font-weight: 600;
            color: #586069;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }
        
        .sidebar ul {
            list-style: none;
            margin-bottom: 20px;
        }
        
        .sidebar li {
            margin-bottom: 8px;
        }
        
        .sidebar a {
            color: #0366d6;
            text-decoration: none;
            font-size: 14px;
            display: block;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .sidebar a:hover {
            background: #e1e4e8;
        }
        
        .sidebar .sub-item {
            margin-left: 20px;
            font-size: 13px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
            max-width: 1200px;
        }
        
        h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e1e4e8;
        }
        
        h2 {
            font-size: 24px;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e1e4e8;
        }
        
        h3 {
            font-size: 20px;
            font-weight: 600;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        
        h4 {
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 12px;
        }
        
        p {
            margin-bottom: 16px;
            line-height: 1.6;
        }
        
        /* Code Blocks */
        pre {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            overflow-x: auto;
            margin-bottom: 16px;
        }
        
        code {
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 14px;
        }
        
        .inline-code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 85%;
        }
        
        /* Lists */
        ul, ol {
            margin-left: 30px;
            margin-bottom: 16px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        /* Package Info */
        .package-info {
            background: #f0f9ff;
            border-left: 4px solid #0366d6;
            padding: 12px 16px;
            margin-bottom: 20px;
        }
        
        /* Performance Stats */
        .performance-box {
            background: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 16px;
            margin: 20px 0;
        }
        
        .performance-box ul {
            margin-left: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Sidebar Table of Contents -->
        <nav class="sidebar">
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#overview">Overview</a></li>
                <li><a href="#quick-start">Quick Start</a></li>
                <li>
                    <a href="#architecture">Architecture</a>
                    <ul class="sub-item">
                        <li><a href="#design-principles">Core Design Principles</a></li>
                        <li><a href="#package-structure">Package Structure</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#implementation">Implementation Details</a>
                    <ul class="sub-item">
                        <li><a href="#generic-entity">GenericEntity Structure</a></li>
                        <li><a href="#conversion">Conversion Process</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#api-docs">API Documentation</a>
                    <ul class="sub-item">
                        <li><a href="#initialization">Storage Initialization</a></li>
                        <li><a href="#operations">Main Operations</a></li>
                        <li><a href="#batch-ops">Batch Operations</a></li>
                    </ul>
                </li>
                <li><a href="#performance">Performance</a></li>
                <li><a href="#development">Development Guidelines</a></li>
                <li><a href="#license">License</a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <h1>GenericEntityStorage Library</h1>
            
            <div class="package-info" id="overview">
                <strong>Package:</strong> com.telcobright.db.genericentity<br>
                A high-performance, reflection-free entity storage library that maps multiple entity types to a generic structure.<br><br>
                <strong>Key Requirements:</strong><br>
                • Mandatory <code>withMaxRecords()</code> parameter for optimal pool sizing<br>
                • Single builder pattern enforces best practices<br>
                • Zero-allocation design through comprehensive object pooling
            </div>

            <h2 id="quick-start">Quick Start</h2>
            <pre><code>// Define your entity type set enum
// The "Set" suffix indicates this enum defines a collection of related entity types
public enum MyEntityTypeSet implements IEntityTypeSet {
    PERSON(1), ORDER(2);
    
    private final int typeId;
    
    MyEntityTypeSet(int typeId) {
        this.typeId = typeId;
    }
    
    @Override
    public int getTypeId() {
        return typeId;
    }
}

// Build storage with mandatory maxRecords for optimal performance
GenericEntityStorage&lt;MyEntityTypeSet&gt; storage = GenericEntityStorage.builder()
    .withEntityTypeSet(MyEntityTypeSet.class)
    .withMaxRecords(600000)  // MANDATORY: Total capacity across all types
    .registerType(MyEntityTypeSet.PERSON, Person.class, 100000)  // max 100k persons
    .registerType(MyEntityTypeSet.ORDER, Order.class, 500000)    // max 500k orders
    .build();

// Or use auto-sizing for convenience
GenericEntityStorage&lt;MyEntityTypeSet&gt; storage = GenericEntityStorage.builder()
    .withEntityTypeSet(MyEntityTypeSet.class)
    .withMaxRecords(600000)  // MANDATORY: Total capacity
    .withAutoSizing()         // Automatically distributes capacity
    .registerType(MyEntityTypeSet.PERSON, Person.class)
    .registerType(MyEntityTypeSet.ORDER, Order.class)
    .build();  // Each type gets 300k capacity

// Store and retrieve entities
Person person = new Person(1L, "John Doe");
storage.put(person, MyEntityTypeSet.PERSON);
Person retrieved = storage.get(1L, MyEntityTypeSet.PERSON);</code></pre>

            <h2 id="architecture">Architecture</h2>
            
            <h3 id="design-principles">Core Design Principles</h3>
            <ol>
                <li><strong>Reflection-free at runtime:</strong> All reflection happens during initialization</li>
                <li><strong>Type-safe:</strong> Enum-based type system ensures compile-time safety</li>
                <li><strong>Performance:</strong> Direct method invocations, no runtime overhead</li>
                <li><strong>Generic storage:</strong> Single HashMap&lt;Long, GenericEntity&gt; stores all types</li>
                <li><strong>Object pooling:</strong> Pre-allocated GenericEntity pool minimizes GC pressure</li>
            </ol>

            <h3 id="package-structure">Package Structure</h3>
            <ul>
                <li>
                    <strong>api/:</strong> Public interfaces and main storage class
                    <ul>
                        <li><code class="inline-code">GenericEntityStorage</code>: Main facade for client interaction</li>
                        <li><code class="inline-code">IEntityTypeSet</code>: Marker interface for entity type set enums</li>
                        <li><code class="inline-code">StorageBuilder</code>: Fluent builder with mandatory maxRecords for optimal pooling</li>
                    </ul>
                </li>
                <li>
                    <strong>core/:</strong> Internal implementation
                    <ul>
                        <li><code class="inline-code">GenericEntity</code>: Universal storage structure (200+ fields)</li>
                        <li><code class="inline-code">EntityConverter</code>: Interface for entity conversions</li>
                        <li><code class="inline-code">EntityRegistry</code>: Manages type registrations</li>
                        <li><strong>impl/:</strong> Concrete implementations including pooled storage</li>
                        <li><strong>pool/:</strong> Object pooling implementation</li>
                    </ul>
                </li>
                <li>
                    <strong>examples/:</strong> Usage examples for different domains
                </li>
            </ul>

            <h2 id="implementation">Implementation Details</h2>
            
            <h3 id="generic-entity">GenericEntity Structure</h3>
            <p>The GenericEntity class provides a universal storage structure with:</p>
            <ul>
                <li>1 ID field (Long)</li>
                <li>20 String fields (string1...string20)</li>
                <li>10 Integer fields (int1...int10)</li>
                <li>10 Long fields (long1...long10)</li>
                <li>10 Double fields (double1...double10)</li>
                <li>10 BigDecimal fields (decimal1...decimal10)</li>
                <li>10 LocalDateTime fields (datetime1...datetime10)</li>
                <li>10 Boolean fields (bool1...bool10)</li>
                <li>10 byte[] fields (bytes1...bytes10)</li>
                <li>Additional fields for Lists, Maps, etc.</li>
            </ul>

            <h3 id="conversion">Conversion Process</h3>
            <ol>
                <li><strong>Startup Phase:</strong> Analyze entity classes via reflection</li>
                <li><strong>Generate Converters:</strong> Create optimized converter instances</li>
                <li><strong>Runtime:</strong> Use pre-generated converters (no reflection)</li>
            </ol>

            <h2 id="api-docs">API Documentation</h2>
            
            <h3 id="initialization">Storage Initialization</h3>
            <pre><code>// Manual capacity distribution
GenericEntityStorage&lt;TSet&gt; storage = GenericEntityStorage.builder()
    .withEntityTypeSet(TSet.class)  // TSet implements IEntityTypeSet
    .withMaxRecords(100000)          // MANDATORY: Total max records
    .registerType(enumValue1, EntityClass1.class, 60000)  // 60k capacity
    .registerType(enumValue2, EntityClass2.class, 40000)  // 40k capacity
    .build();

// Auto-sizing for even distribution
GenericEntityStorage&lt;TSet&gt; storage = GenericEntityStorage.builder()
    .withEntityTypeSet(TSet.class)  // TSet implements IEntityTypeSet
    .withMaxRecords(100000)          // MANDATORY: Total max records
    .withAutoSizing()                // Evenly distributes capacity
    .registerType(enumValue1, EntityClass1.class)  // Gets 50k
    .registerType(enumValue2, EntityClass2.class)  // Gets 50k
    .build();</code></pre>

            <h3 id="operations">Main Operations</h3>
            
            <h4>Store Entity</h4>
            <pre><code>void put(Object entity, TSet entityType)  // TSet is your entity type set enum</code></pre>
            
            <h4>Retrieve Entity</h4>
            <pre><code>&lt;E&gt; E get(Long id, TSet entityType)  // TSet is your entity type set enum</code></pre>
            
            <h4>Remove Entity</h4>
            <pre><code>void remove(Long id, TSet entityType)  // TSet is your entity type set enum</code></pre>
            
            <h4>Check Existence</h4>
            <pre><code>boolean exists(Long id, TSet entityType)  // TSet is your entity type set enum</code></pre>

            <h3 id="batch-ops">Batch Operations</h3>
            <pre><code>void putAll(List&lt;?&gt; entities, TSet entityType)
List&lt;E&gt; getAll(TSet entityType)
void removeAll(TSet entityType)</code></pre>

            <h2 id="performance">Performance Characteristics</h2>
            <div class="performance-box">
                <ul>
                    <li><strong>Initialization:</strong> O(n) where n = number of registered types</li>
                    <li><strong>Put/Get/Remove:</strong> O(1) HashMap operations</li>
                    <li><strong>Memory:</strong> Pre-sized pools based on maxRecords parameter</li>
                    <li><strong>No reflection at runtime:</strong> Direct method calls only</li>
                    <li><strong>Zero allocations in hot path:</strong> All objects borrowed from pools</li>
                    <li><strong>Throughput:</strong> ~650,000+ ops/sec with optimized pooling</li>
                    <li><strong>GC overhead:</strong> &lt;8% under heavy load (3M operations)</li>
                </ul>
            </div>
            
            <h3>Optimizations with Mandatory maxRecords</h3>
            <div class="performance-box">
                <ul>
                    <li><strong>GenericEntity Pool:</strong> Pre-allocated with 20% buffer (maxRecords * 1.2)</li>
                    <li><strong>CompositeKey Pool:</strong> Sized at 2x maxRecords for lookup operations</li>
                    <li><strong>Pre-allocation:</strong> 10-25% of capacity created upfront</li>
                    <li><strong>Proxy ID System:</strong> Prevents ID collisions between entity types</li>
                    <li><strong>Fast Recycling:</strong> Efficient field clearing for object reuse</li>
                    <li><strong>Auto-sizing:</strong> Optional automatic capacity distribution</li>
                </ul>
            </div>

            <h2 id="development">Development Guidelines</h2>
            
            <h3>For AI Agents Continuing Development</h3>
            
            <h4>1. Converter Generation Strategy</h4>
            <ul>
                <li>Use MethodHandles for Java 7+</li>
                <li>Consider ByteBuddy for complex mappings</li>
                <li>Cache all reflection metadata at startup</li>
            </ul>

            <h4>2. Field Mapping Rules</h4>
            <ul>
                <li>Simple types: Direct mapping</li>
                <li>Collections: Serialize to byte[] or use reserved list fields</li>
                <li>Complex objects: Flatten or use nested GenericEntity</li>
            </ul>

            <h4>3. Optimization Opportunities</h4>
            <ul>
                <li>Implement field pooling for common values</li>
                <li>Add compression for sparse entities</li>
                <li>Consider memory-mapped storage for large datasets</li>
            </ul>

            <h4>4. Testing Requirements</h4>
            <ul>
                <li>Unit tests for each converter</li>
                <li>Performance benchmarks vs native HashMap</li>
                <li>Thread-safety tests for concurrent access</li>
                <li>Mutation tests with million+ iterations</li>
            </ul>

            <h4>5. Extension Points</h4>
            <ul>
                <li>Custom field mappers</li>
                <li>Storage backends (Redis, Hazelcast)</li>
                <li>Query capabilities</li>
                <li>Index support</li>
            </ul>

            <h2 id="license">License</h2>
            <p>MIT License - See LICENSE file for details</p>
        </main>
    </div>
    
    <script>
        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
        
        // Highlight current section in sidebar
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('h2[id], h3[id]');
            const scrollPos = window.scrollY + 100;
            
            sections.forEach(section => {
                const id = section.getAttribute('id');
                const link = document.querySelector(`.sidebar a[href="#${id}"]`);
                
                if (link) {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    
                    if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
                        document.querySelectorAll('.sidebar a').forEach(a => a.style.fontWeight = 'normal');
                        link.style.fontWeight = 'bold';
                    }
                }
            });
        });
    </script>
</body>
</html>